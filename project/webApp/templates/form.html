{% extends "index.html" %}
{% block form %}

<div class="box">
<!--   <div class="col-md-6" style="padding:10px;" class="box">-->
    <h5>You want to depart at {{ journeyTime }} on {{ day }} the {{ date}}th of {{ month }}</h5>
      <h5> The time between Stop {{ origin }} and Stop {{ destination }} is: <br>
         Time = {{ time }} minutes     
      </h5>
       <h4> Stop-to-stop info will go here - how long between each stop or something </h4>
<!--   <div class="col-lg-7">-->
      <!-- This is just to show how the map will look. Will probably have to change to a JavaScript map to get markers and that in but this is where it'll go anyway. For now this is just a placeholder -->
<!--
      <iframe width="600" height="450" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyAlWdso5n60j97uMVDtQDSDQb9AxgYcEhU&q=University+College+Dublin,Dublin" allowfullscreen>
      </iframe>
-->
<!--   </div>-->
    
</div>
<br>

<script>
var stops = {{ stops|tojson|safe }};
    var req = {{ req|tojson|safe }}
    
    var key = req['route'] + ', ' + req['direction'];
    console.log(stops);
    console.log(key);
    
    var route_stops = stops[key];
    console.log(route_stops);
    
    // Get list of passed by stops
    var flag = false;
    var start_index = '0';
    var start_index = '0';
    var pass_stops_lat = [];
    var pass_stops_lon = [];
    var pass_stops_name = [];
    
    jQuery.each(route_stops['stop_id'], function(i, val) {
        if(val == req['orig_stop_id'])
            flag = true;
        
        if (flag) {
            pass_stops_lat.push(route_stops['stop_lat'][i]);
            pass_stops_lon.push(route_stops['stop_lon'][i]);
            pass_stops_name.push(route_stops['stop_name'][i]);
        }
        if(val == req['dest_stop_id'])
            flag = false;
        
    });
    
    // Draw map
    function initMap() {
        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer;
        directionsDisplay.setOptions( { suppressMarkers: true } );
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: {lat: pass_stops_lat[0], lng: pass_stops_lon[0]},
        });

    directionsDisplay.setMap(map);
        
    var waypts = [];
    orig_position = {lat: pass_stops_lat[0], lng: pass_stops_lon[0]};
    dest_position = {lat:pass_stops_lat[pass_stops_lat.length-1], lng: pass_stops_lon[pass_stops_lat.length-1]};
        
    for(var i=1; i<pass_stops_lat.length-1; i++)
        waypts.push({stopover:true, location: {lat: pass_stops_lat[i], lng: pass_stops_lon[i]}});
    
    directionsService.route({
        origin: orig_position,
        destination: dest_position,
        waypoints: waypts,
        optimizeWaypoints: true,
        travelMode: 'DRIVING'
        }, 
        function(result, status) {
            if (status == 'OK') {
                directionsDisplay.setDirections(result);
            }
        });
        
        
    var marker = new google.maps.Marker({
        position: orig_position,
        label: {
            text: pass_stops_name[0],
            color: '#2b25b2',
            fontSize: "14px"
        },
        icon: { url: "{{ url_for('static', filename='markerBlue.png') }}",
                        scaledSize: new google.maps.Size(50, 50)
            }
        
    });
    marker.setMap(map);
    var marker = new google.maps.Marker({
        position: dest_position,
        label: {
            text: pass_stops_name[pass_stops_name.length-1],
            color: '#2b25b2',
            fontSize: "14px"
        },
        icon: { url: "{{ url_for('static', filename='markerGreen.png') }}",
                        scaledSize: new google.maps.Size(50, 50)
            }
    });
    marker.setMap(map);
        
    };
    </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA42LkjmNjm_bQCtgfGfnAIu-yZ9B1aRYU&callback=initMap" type="text/javascript"></script>
{% endblock %}


<!--
<div class="row">
   <div class="col-md-5" style="padding:10px;" class="box">
      <h3> The time between Stop {{ origin }} and Stop {{ destination }} is: <br>
         Time = {{ time }} minutes     
      </h3>
       <h3> Stop-to-stop info will go here - how long between each stop or somthing </h3>
   </div>
<!--   <div class="col-lg-7">-->
      <!-- This is just to show how the map will look. Will probably have to change to a JavaScript map to get markers and that in but this is where it'll go anyway. For now this is just a placeholder -->
<!--
      <iframe width="600" height="450" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyAlWdso5n60j97uMVDtQDSDQb9AxgYcEhU&q=University+College+Dublin,Dublin" allowfullscreen>
      </iframe>
-->
<!--   </div>-->
<!--
</div>
<br><br>
-->



<!--
<div class="row">
    <div class="col-lg-5"></div>
   <div class="col-sm-7">
      <h3> Keep track of the road conditions all across the country! </h3>
       To input twitter feed on webpage obtained from https://support.twitter.com/articles/20170071
      <a class="twitter-timeline" data-width="500" data-height="300" data-theme="light" href="https://twitter.com/aaroadwatch">Tweets by aaroadwatch</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
       <br>
       
       <h4> Follow us on Twitter or Tweet to us! </h4>
       <a href="https://twitter.com/Team1010_DubBus" class="twitter-follow-button" data-show-count="false">Follow @Team1010_DubBus</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
          <a href="https://twitter.com/intent/tweet?screen_name=Team1010_DubBus" class="twitter-mention-button" data-show-count="false">Tweet to @Team1010_DubBus</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
   </div>
</div>
-->

